---
description: When creating files, immediately register for tracking (WIP, feature, or documentation)
globs: 
alwaysApply: true
---

# File Creation Protocol

## **Core Principle: All Files Must Be Tracked**

**Every file you create must immediately be tracked in one of four ways:**

1. **Committed** (via `sc git commit` or `git commit`)
2. **WIP-tracked** (via `sc workflow wip register`)
3. **Documented** (via feature/requirement documentation)
4. **Ignored** (added to `.gitignore`)

**NEVER leave files untracked** - this will block commits when 5+ untracked files accumulate.

---

## **Decision Tree: "I Just Created a File..."**

### **Step 1: What Type of File?**

```
Is it...
‚îú‚îÄ Ready to commit? ‚Üí sc git commit <file> -m "feat(scope): message"
‚îú‚îÄ Work in progress? ‚Üí sc workflow wip register <file> --feature=X
‚îú‚îÄ Generated/temporary? ‚Üí echo "<pattern>" >> .gitignore
‚îî‚îÄ Part of larger feature? ‚Üí sc workflow wip register <file> --feature=X --requirement=REQ-XXX
```

---

## **When to Use Each Method**

### **‚úÖ Commit Immediately** (Preferred)

```bash
# Small, complete changes
touch src/utils/new-helper.ts
# ... write complete code ...
sc git commit src/utils/new-helper.ts -m "feat(utilities): add new helper"
```

**Use when:**
- File is complete and tested
- Part of atomic change
- Ready for review

---

### **‚úÖ WIP Register** (For Active Development)

```bash
# Complex feature, not ready yet
touch src/components/NewFeature.tsx
touch src/components/NewFeature.test.tsx
touch src/hooks/useNewFeature.ts

# Register all as WIP
sc workflow wip register src/components/NewFeature.tsx --feature=new-feature --requirement=REQ-042
sc workflow wip register src/components/NewFeature.test.tsx --feature=new-feature --requirement=REQ-042
sc workflow wip register src/hooks/useNewFeature.ts --feature=new-feature --requirement=REQ-042
```

**Use when:**
- Multi-file feature
- Still prototyping
- Need to checkpoint work
- Multiple agents working in parallel

---

### **‚úÖ Gitignore** (For Generated/Temporary Files)

```bash
# Build artifacts, logs, temp files
echo "*.log" >> .gitignore
echo ".temp/" >> .gitignore
echo "dist/" >> .gitignore
```

**Use when:**
- Generated by build process
- Temporary scratch files
- IDE/editor artifacts
- Should never be committed

---

### **‚úÖ Document in Feature/Requirement**

```bash
# Create files from documentation
sc docs process docs/features/new-feature/planning/implementation.md --commit

# Or document in requirement
# (Add file path to requirement's "implementation" section)
```

**Use when:**
- Following documentation-driven development
- File is planned in requirement
- Part of structured feature

---

## **Common Scenarios**

### **Scenario 1: Refactoring Existing Code**

```bash
# Extract utility function
touch src/utils/validation.ts

# Option A: Commit immediately (if complete)
sc git commit src/utils/validation.ts -m "refactor(utils): extract validation utils"

# Option B: WIP register (if ongoing)
sc workflow wip register src/utils/validation.ts --feature=refactor --reason="Extracting validation logic"
```

---

### **Scenario 2: New Feature (Multiple Files)**

```bash
# Create feature structure
mkdir -p src/features/user-profile
touch src/features/user-profile/UserProfile.tsx
touch src/features/user-profile/UserProfile.test.tsx
touch src/features/user-profile/useUserProfile.ts

# WIP register ALL files for the feature
for file in src/features/user-profile/*; do
  sc workflow wip register "$file" --feature=user-profile --requirement=REQ-127
done

# Later: Commit together when complete
git add src/features/user-profile/
sc git commit -m "feat(user-profile): add user profile feature (REQ-127)"
```

---

### **Scenario 3: Experiment/Spike**

```bash
# Quick experiment
touch experiments/new-approach.ts

# Option A: WIP register with reason
sc workflow wip register experiments/new-approach.ts --feature=experiment --reason="Testing new validation approach"

# Option B: Ignore experiments directory
echo "experiments/" >> .gitignore
```

---

### **Scenario 4: Documentation**

```bash
# Create feature documentation
touch docs/features/auth/new-flow.md

# Commit immediately (docs are rarely WIP)
sc git commit docs/features/auth/new-flow.md -m "docs(auth): document new auth flow"
```

---

## **Integration with Pre-Commit Hook**

When you try to commit with 5+ untracked files:

```bash
$ git commit -m "feat: some change"

üö® WIP Registry Check: FAILED
   Detected 7 untracked files (threshold: 5)

üí° Fix options:
   1. WIP register: sc workflow wip register <file> --feature=<name>
   2. Commit ready: git add <file> && git commit
   3. Ignore temp: echo "<pattern>" >> .gitignore

üìã Smart workflow:
   sc workflow wip check                        # Auto-suggest WIP registrations
```

---

## **Best Practices**

### **‚úÖ DO: Track Immediately**

```bash
# RIGHT: Create ‚Üí Track ‚Üí Continue
touch new-file.ts
sc workflow wip register new-file.ts --feature=X
# ... continue working ...
```

### **‚ùå DON'T: Accumulate Untracked Files**

```bash
# WRONG: Create many, track later
touch file1.ts file2.ts file3.ts file4.ts file5.ts file6.ts
# ... days pass ...
# Now you can't commit! 6 untracked files blocking
```

---

### **‚úÖ DO: Use Feature Tags**

```bash
# Group by feature
sc workflow wip register auth.ts --feature=authentication
sc workflow wip register login.tsx --feature=authentication
sc workflow wip register session.ts --feature=authentication

# Commit together later
sc git commit auth.ts login.tsx session.ts -m "feat(authentication): complete auth system"
```

---

### **‚úÖ DO: Clean Up WIP Registry**

```bash
# Check old WIP entries
sc workflow wip list --older-than 7d

# Cleanup or commit
sc workflow wip cleanup --older-than 7d
```

---

## **Quick Reference**

| File Type | Action | Command |
|----|----|----|
| **Complete code** | Commit now | `sc git commit <file> -m "feat(scope): msg"` |
| **Work in progress** | WIP register | `sc workflow wip register <file> --feature=X` |
| **Multi-file feature** | WIP register all | Loop + `sc workflow wip register` |
| **Generated/temp** | Ignore | `echo "<pattern>" >> .gitignore` |
| **Documentation** | Usually commit | `sc git commit <file> -m "docs: ..."` |
| **Experiment** | WIP or ignore | Context-dependent |

---

## **Automation**

The system will help you:

1. **Pre-commit hook** blocks at 5+ untracked files
2. **`sc git-smart check-wip`** suggests WIP registrations (coming soon)
3. **`sc workflow wip status`** shows current untracked count
4. **`sc workflow wip cleanup`** removes old entries

---

## **Related Rules & SOPs**

- [wip-registry.mdc](.cursor/rules/wip-registry.mdc) - WIP system details
- [git-commit-smart.mdc](.cursor/rules/git-commit-smart.mdc) - Commit guidelines
- [feature-management.mdc](.cursor/rules/feature-management.mdc) - Feature-based commits
- [SOP-0.1.12](docs/workflow/sops/general/SOP-0.1.12-git-workflow.md) - Git workflow

---

**Last Updated**: 2025-12-16  
**Status**: Active  
**Enforcement**: Pre-commit hook (5+ file threshold)
